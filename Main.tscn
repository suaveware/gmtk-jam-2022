[gd_scene load_steps=21 format=2]

[ext_resource path="res://src/Player/Player.gd" type="Script" id=1]
[ext_resource path="res://src/classes/Grid.gd" type="Script" id=2]
[ext_resource path="res://src/classes/CameraPivot.gd" type="Script" id=3]
[ext_resource path="res://Main.gd" type="Script" id=4]
[ext_resource path="res://theme.tres" type="Theme" id=5]
[ext_resource path="res://src/DiceHud/DiceHud.tscn" type="PackedScene" id=6]
[ext_resource path="res://assets/dice.obj" type="ArrayMesh" id=7]
[ext_resource path="res://default_env.tres" type="Environment" id=8]
[ext_resource path="res://assets/fonts/EduSABeginner-Bold.ttf" type="DynamicFontData" id=9]
[ext_resource path="res://Gui.gd" type="Script" id=10]
[ext_resource path="res://assets/icons/audioOn.png" type="Texture" id=11]
[ext_resource path="res://assets/icons/musicOn.png" type="Texture" id=12]
[ext_resource path="res://assets/icons/musicOff.png" type="Texture" id=13]
[ext_resource path="res://assets/icons/audioOff.png" type="Texture" id=14]
[ext_resource path="res://assets/fonts/EduSABeginner-Medium.ttf" type="DynamicFontData" id=15]
[ext_resource path="res://assets/fonts/EduSABeginner-SemiBold.ttf" type="DynamicFontData" id=16]

[sub_resource type="DynamicFont" id=4]
size = 94
font_data = ExtResource( 16 )

[sub_resource type="DynamicFont" id=2]
size = 130
outline_size = 5
outline_color = Color( 0, 0, 0, 1 )
font_data = ExtResource( 9 )

[sub_resource type="DynamicFont" id=3]
size = 64
font_data = ExtResource( 15 )

[sub_resource type="SpatialMaterial" id=1]

[node name="Main" type="Spatial"]
script = ExtResource( 4 )
levels = [ "res://src/levels/level1.tres", "res://src/levels/level2.tres", "res://src/levels/level3.tres", "res://src/levels/level4.tres", "res://src/levels/level5.tres", "res://src/levels/level6.tres", "res://src/levels/level7.tres", "res://src/levels/level8.tres", "res://src/levels/level9.tres" ]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = ExtResource( 8 )

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Gui" type="Control" parent="CanvasLayer"]
anchor_right = 1.0
anchor_bottom = 1.0
theme = ExtResource( 5 )
script = ExtResource( 10 )

[node name="LevelNumber" type="Label" parent="CanvasLayer/Gui"]
margin_left = 1829.0
margin_top = 931.0
margin_right = 1885.0
margin_bottom = 1050.0
grow_horizontal = 0
grow_vertical = 0
custom_fonts/font = SubResource( 4 )
text = "0"

[node name="Prefix" type="Label" parent="CanvasLayer/Gui/LevelNumber"]
margin_left = -233.0
margin_right = 9.0
margin_bottom = 119.0
custom_fonts/font = SubResource( 4 )
text = "Level: "

[node name="VBoxContainer" type="HBoxContainer" parent="CanvasLayer/Gui"]
anchor_top = 1.0
anchor_bottom = 1.0
margin_left = 27.0
margin_top = -139.0
margin_right = 231.0
margin_bottom = -39.0

[node name="MusicToggle" type="TextureButton" parent="CanvasLayer/Gui/VBoxContainer" groups=["button"]]
margin_right = 100.0
margin_bottom = 100.0
toggle_mode = true
texture_normal = ExtResource( 12 )
texture_pressed = ExtResource( 13 )

[node name="SoundToggle" type="TextureButton" parent="CanvasLayer/Gui/VBoxContainer" groups=["button"]]
margin_left = 104.0
margin_right = 204.0
margin_bottom = 100.0
toggle_mode = true
texture_normal = ExtResource( 11 )
texture_pressed = ExtResource( 14 )

[node name="HBoxContainer" type="HBoxContainer" parent="CanvasLayer/Gui"]
margin_left = 29.0
margin_top = 31.0
margin_right = 304.0
margin_bottom = 190.0
custom_constants/separation = 38

[node name="Label" type="Label" parent="CanvasLayer/Gui/HBoxContainer"]
margin_right = 285.0
margin_bottom = 213.0
text = "R to reset
Q, E to rotate view
W, A, S, D to roll
B to return to menu"

[node name="DiceHud" parent="CanvasLayer/Gui" instance=ExtResource( 6 )]
visible = false
player_path = NodePath("../../../Player")

[node name="EndScreen" type="Label" parent="CanvasLayer/Gui"]
visible = false
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -242.0
margin_top = -437.0
margin_right = 243.0
margin_bottom = -272.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = SubResource( 2 )
text = "The end"
align = 1

[node name="MainMenuButton" type="Button" parent="CanvasLayer/Gui/EndScreen"]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -171.5
margin_top = 661.5
margin_right = 190.5
margin_bottom = 743.5
text = "Main menu"

[node name="Label" type="Label" parent="CanvasLayer/Gui/EndScreen"]
margin_left = 33.0
margin_top = 202.0
margin_right = 490.0
margin_bottom = 284.0
custom_fonts/font = SubResource( 3 )
text = "Thanks for playing!"

[node name="NiceRoll" type="Label" parent="CanvasLayer/Gui"]
visible = false
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -242.5
margin_top = -437.0
margin_right = 242.5
margin_bottom = -272.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = SubResource( 2 )
text = "Nice roll!"

[node name="NextLevelButton" type="Button" parent="CanvasLayer/Gui/NiceRoll" groups=["button"]]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -152.0
margin_top = 661.5
margin_right = 153.0
margin_bottom = 743.5
text = "Next level"

[node name="TutorialText" type="Label" parent="CanvasLayer/Gui"]
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_top = -192.0
align = 1

[node name="Grid" type="Spatial" parent="."]
script = ExtResource( 2 )

[node name="Tween" type="Tween" parent="Grid"]

[node name="CameraPivot" type="Spatial" parent="."]
script = ExtResource( 3 )

[node name="Camera" type="Camera" parent="CameraPivot"]
transform = Transform( 0.707107, -0.353553, 0.612373, 0, 0.866026, 0.499999, -0.707107, -0.353553, 0.612373, 38.8885, 31.849, 38.8885 )
projection = 1
current = true
size = 20.0

[node name="Tween" type="Tween" parent="CameraPivot"]

[node name="Player" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0 )
script = ExtResource( 1 )

[node name="Tween" type="Tween" parent="Player"]

[node name="Pivot" type="Position3D" parent="Player"]

[node name="Rotator" type="Spatial" parent="Player/Pivot"]

[node name="Mesh" type="MeshInstance" parent="Player/Pivot/Rotator"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0 )
mesh = ExtResource( 7 )
skeleton = NodePath("Left")
material/0 = SubResource( 1 )

[node name="Left" type="Position3D" parent="Player/Pivot/Rotator/Mesh"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1, 0, 0 )

[node name="Right" type="Position3D" parent="Player/Pivot/Rotator/Mesh"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0 )

[node name="Forward" type="Position3D" parent="Player/Pivot/Rotator/Mesh"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1 )

[node name="Back" type="Position3D" parent="Player/Pivot/Rotator/Mesh"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1 )

[node name="Up" type="Position3D" parent="Player/Pivot/Rotator/Mesh"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0 )

[node name="Down" type="Position3D" parent="Player/Pivot/Rotator/Mesh"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 0 )

[connection signal="game_state_changed" from="." to="CanvasLayer/Gui" method="_on_Main_game_state_changed"]
[connection signal="game_state_changed" from="." to="Grid" method="_on_Main_game_state_changed"]
[connection signal="toggled" from="CanvasLayer/Gui/VBoxContainer/MusicToggle" to="." method="_on_MusicToggle_toggled"]
[connection signal="toggled" from="CanvasLayer/Gui/VBoxContainer/SoundToggle" to="." method="_on_SoundToggle_toggled"]
[connection signal="pressed" from="CanvasLayer/Gui/EndScreen/MainMenuButton" to="." method="_on_MainMenuButton_pressed"]
[connection signal="pressed" from="CanvasLayer/Gui/NiceRoll/NextLevelButton" to="." method="_on_NextLevelButton_pressed"]
[connection signal="player_won" from="Grid" to="." method="_on_Grid_player_won"]
[connection signal="tween_all_completed" from="Grid/Tween" to="." method="_on_Tween_tween_all_completed"]
[connection signal="rotated" from="CameraPivot" to="." method="_on_CameraPivot_rotated"]
[connection signal="moved" from="Player" to="Grid" method="_on_Player_moved"]
[connection signal="tween_step" from="Player/Tween" to="Player" method="_on_Tween_tween_step"]
